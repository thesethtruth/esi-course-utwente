
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Tutorial 3: Capacity expansion modelling &#8212; Energy system modelling workshop ESI</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!-- 
    this give us a css class that will be invisible only if js is disabled 
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="_static/scripts/fontawesome.js?digest=26a4bc78f4c0ddb94549"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549" />

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = '03-tutorial-capacity-expansion';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Exercises 3: Capacity expansion modelling" href="03-exercises-capacity-expansion.html" />
    <link rel="prev" title="Exercises 2: Scenario modelling" href="02-exercises-scenario-modelling.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="Energy system modelling workshop ESI - Home"/>
    <img src="_static/logo.png" class="logo__image only-dark pst-js-only" alt="Energy system modelling workshop ESI - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Welcome
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="01-tutorial-data-analysis.html">Tutorial 1: Energy data analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="01-exercises-data-analysis.html">Exercises 1: Data analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="02-tutorial-scenario-modelling.html">Tutorial 2: Energy System Scenario Modelling</a></li>
<li class="toctree-l1"><a class="reference internal" href="02-exercises-scenario-modelling.html">Exercises 2: Scenario modelling</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Tutorial 3: Capacity expansion modelling</a></li>
<li class="toctree-l1"><a class="reference internal" href="03-exercises-capacity-expansion.html">Exercises 3: Capacity expansion modelling</a></li>
<li class="toctree-l1"><a class="reference internal" href="04-tutorial-interconnection-and-multinodal.html">Tutorial 4: Interconnection and multinodal networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="04-exercises-interconnection-and-multinodal.html">Exercises 4: Storage, dispatchable generation and interconnection</a></li>
<li class="toctree-l1"><a class="reference internal" href="conclusion.html">Conclusion</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/thesethtruth/esi-course-utwente/blob/main/esi-modelling-workshop/03-tutorial-capacity-expansion.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>



<a href="https://github.com/thesethtruth/esi-course-utwente" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/03-tutorial-capacity-expansion.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Tutorial 3: Capacity expansion modelling</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-preparation">Data preparation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1-load-data-processing">Step 1: Load data processing</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2-combining-timeseries-data">Step 2: Combining timeseries data</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#network-creation-and-optimization">Network creation and optimization</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#baseline-scenario-analysis">Baseline scenario analysis</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-the-energy-system-configuration">Plot the energy system configuration</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#baseline-with-renewable-generation-limits">Baseline with renewable generation limits</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Plot the energy system configuration</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#impact-of-generation-capacity-limits">Impact of generation capacity limits</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#baseline-with-renewable-generation-limits-and-flow-battery-scenario">Baseline with renewable generation limits and flow battery scenario</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Plot the energy system configuration</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#impact-of-adding-long-duration-energy-storage">Impact of adding long-duration energy storage</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sensitivity-analysis">Sensitivity analysis</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#define-scenarios-and-run-the-optimisation-problems">Define scenarios and run the optimisation problems</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#results-visualisation">Results visualisation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sensitivity-analysis-results">Sensitivity analysis results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#detailed-analysis-of-system-dynamics">Detailed analysis of system dynamics</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion">Conclusion</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#next-steps">Next steps</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="tutorial-3-capacity-expansion-modelling">
<h1>Tutorial 3: Capacity expansion modelling<a class="headerlink" href="#tutorial-3-capacity-expansion-modelling" title="Link to this heading">#</a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">#</a></h2>
<p>This tutorial demonstrates how to perform capacity expansion modeling using PyPSA (Python for Power System Analysis). We’ll build a simple power system model that optimizes the deployment of renewable energy sources (wind and solar) along with storage capacity to meet electricity demand at minimum cost.</p>
</section>
<section id="data-preparation">
<h2>Data preparation<a class="headerlink" href="#data-preparation" title="Link to this heading">#</a></h2>
<p>First, we need to prepare our input data. We’ll process load data and renewable generation profiles.</p>
<section id="step-1-load-data-processing">
<h3>Step 1: Load data processing<a class="headerlink" href="#step-1-load-data-processing" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># imports and settings for the plotting</span>
<span class="kn">from</span> <span class="nn">pypsa</span> <span class="kn">import</span> <span class="n">Network</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="n">sns</span><span class="o">.</span><span class="n">set_theme</span><span class="p">(</span><span class="s2">&quot;notebook&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s2">&quot;axes.spines&quot;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load the data</span>
<span class="n">RAW_FILE</span> <span class="o">=</span> <span class="s2">&quot;data/merit_order.csv&quot;</span>
<span class="n">OUTPUT_FILE</span> <span class="o">=</span> <span class="s2">&quot;data/load.csv&quot;</span>
<span class="n">NORMALIZE</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">RESET_INDEX_YEAR</span> <span class="o">=</span> <span class="mi">2019</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">RAW_FILE</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="s2">&quot;.input&quot;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="k">if</span> <span class="n">NORMALIZE</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">/</span> <span class="n">data</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

<span class="k">if</span> <span class="n">RESET_INDEX_YEAR</span><span class="p">:</span>
    <span class="n">data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span>
        <span class="n">start</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">RESET_INDEX_YEAR</span><span class="si">}</span><span class="s2">-01-01&quot;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;h&quot;</span>
    <span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
<span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;time&quot;</span>
<span class="n">data</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;load&quot;</span><span class="p">]</span>
<span class="n">data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">OUTPUT_FILE</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="step-2-combining-timeseries-data">
<h3>Step 2: Combining timeseries data<a class="headerlink" href="#step-2-combining-timeseries-data" title="Link to this heading">#</a></h3>
<p>We combine the timeseries to an uniform data format for ease of use in our optimisation model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load the data files</span>

<span class="n">LOAD_FP</span> <span class="o">=</span> <span class="s2">&quot;data/load.csv&quot;</span>
<span class="n">SOLAR_FP</span> <span class="o">=</span> <span class="s2">&quot;data/solar.csv&quot;</span>
<span class="n">WIND_FP</span> <span class="o">=</span> <span class="s2">&quot;data/wind.csv&quot;</span>


<span class="n">load_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="n">LOAD_FP</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;load&quot;</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">solar_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">SOLAR_FP</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">wind_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">WIND_FP</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Combine based on load timestamps</span>
<span class="n">combined_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">load_data</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">combined_data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;time&quot;</span>
<span class="n">combined_data</span><span class="p">[</span><span class="s2">&quot;load&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">load_data</span><span class="p">[</span><span class="s2">&quot;load&quot;</span><span class="p">]</span>
<span class="n">combined_data</span><span class="p">[</span><span class="s2">&quot;solar&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">solar_data</span><span class="p">[</span><span class="s2">&quot;electricity&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">combined_data</span><span class="p">[</span><span class="s2">&quot;wind&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wind_data</span><span class="p">[</span><span class="s2">&quot;electricity&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="c1"># Save the combined timeseries</span>
<span class="n">combined_data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;data/timeseries.csv&quot;</span><span class="p">)</span>

<span class="n">ts</span> <span class="o">=</span> <span class="n">combined_data</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="network-creation-and-optimization">
<h2>Network creation and optimization<a class="headerlink" href="#network-creation-and-optimization" title="Link to this heading">#</a></h2>
<p>Now we’ll create our network model. We’ll analyze three different scenarios with varying cost ratios between generation and storage. We will first define some functions that reuse.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_network</span><span class="p">(</span>
    <span class="n">ts</span><span class="p">,</span>
    <span class="n">costs</span><span class="p">,</span>
    <span class="n">generation_cost_multiplier</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">storage_cost_multiplier</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">add_flow_battery</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">limit_renewable_energy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Network</span><span class="p">:</span>

    <span class="c1"># Adjust costs based on multipliers</span>
    <span class="n">costs</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="s2">&quot;wind&quot;</span><span class="p">,</span> <span class="s2">&quot;solar&quot;</span><span class="p">],</span> <span class="s2">&quot;capital_cost&quot;</span><span class="p">]</span> <span class="o">*=</span> <span class="n">generation_cost_multiplier</span>
    <span class="n">costs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
        <span class="p">[</span><span class="s2">&quot;battery inverter&quot;</span><span class="p">,</span> <span class="s2">&quot;battery storage&quot;</span><span class="p">],</span> <span class="s2">&quot;capital_cost&quot;</span>
    <span class="p">]</span> <span class="o">*=</span> <span class="n">storage_cost_multiplier</span>

    <span class="c1"># initialize network</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">Network</span><span class="p">()</span>
    <span class="n">n</span><span class="o">.</span><span class="n">set_snapshots</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="n">n</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;Bus&quot;</span><span class="p">,</span> <span class="s2">&quot;electricity&quot;</span><span class="p">)</span>

    <span class="c1"># add load</span>
    <span class="n">n</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="s2">&quot;Load&quot;</span><span class="p">,</span>
        <span class="s2">&quot;demand&quot;</span><span class="p">,</span>
        <span class="n">bus</span><span class="o">=</span><span class="s2">&quot;electricity&quot;</span><span class="p">,</span>
        <span class="n">p_set</span><span class="o">=</span><span class="n">ts</span><span class="o">.</span><span class="n">load</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># add solar and wind</span>
    <span class="n">tech_limits</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;wind&quot;</span><span class="p">:</span> <span class="mf">150e3</span><span class="p">,</span>
        <span class="s2">&quot;solar&quot;</span><span class="p">:</span> <span class="mf">300e3</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="n">tech</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;wind&quot;</span><span class="p">,</span> <span class="s2">&quot;solar&quot;</span><span class="p">]:</span>
        <span class="n">n</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
            <span class="s2">&quot;Generator&quot;</span><span class="p">,</span>
            <span class="n">tech</span><span class="p">,</span>
            <span class="n">bus</span><span class="o">=</span><span class="s2">&quot;electricity&quot;</span><span class="p">,</span>
            <span class="n">p_max_pu</span><span class="o">=</span><span class="n">ts</span><span class="p">[</span><span class="n">tech</span><span class="p">],</span>
            <span class="n">capital_cost</span><span class="o">=</span><span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">tech</span><span class="p">,</span> <span class="s2">&quot;capital_cost&quot;</span><span class="p">],</span>
            <span class="n">marginal_cost</span><span class="o">=</span><span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">tech</span><span class="p">,</span> <span class="s2">&quot;marginal_cost&quot;</span><span class="p">],</span>
            <span class="n">p_nom_extendable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">p_nom_max</span><span class="o">=</span><span class="n">tech_limits</span><span class="p">[</span><span class="n">tech</span><span class="p">]</span> <span class="k">if</span> <span class="n">limit_renewable_energy</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># add short-duration battery storage</span>
    <span class="n">EP_RATIO</span> <span class="o">=</span> <span class="mi">6</span>
    <span class="n">n</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="s2">&quot;StorageUnit&quot;</span><span class="p">,</span>
        <span class="s2">&quot;battery storage&quot;</span><span class="p">,</span>
        <span class="n">bus</span><span class="o">=</span><span class="s2">&quot;electricity&quot;</span><span class="p">,</span>
        <span class="n">max_hours</span><span class="o">=</span><span class="n">EP_RATIO</span><span class="p">,</span>
        <span class="n">capital_cost</span><span class="o">=</span><span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;battery inverter&quot;</span><span class="p">,</span> <span class="s2">&quot;capital_cost&quot;</span><span class="p">]</span>
        <span class="o">+</span> <span class="n">EP_RATIO</span> <span class="o">*</span> <span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;battery storage&quot;</span><span class="p">,</span> <span class="s2">&quot;capital_cost&quot;</span><span class="p">],</span>
        <span class="n">efficiency_store</span><span class="o">=</span><span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;battery inverter&quot;</span><span class="p">,</span> <span class="s2">&quot;efficiency&quot;</span><span class="p">],</span>
        <span class="n">efficiency_dispatch</span><span class="o">=</span><span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;battery inverter&quot;</span><span class="p">,</span> <span class="s2">&quot;efficiency&quot;</span><span class="p">],</span>
        <span class="n">p_nom_extendable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">cyclic_state_of_charge</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">add_flow_battery</span><span class="p">:</span>
        <span class="c1"># add long-duration flow battery</span>
        <span class="n">FLOW_EP_RATIO</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="n">n</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
            <span class="s2">&quot;StorageUnit&quot;</span><span class="p">,</span>
            <span class="s2">&quot;flow battery&quot;</span><span class="p">,</span>
            <span class="n">bus</span><span class="o">=</span><span class="s2">&quot;electricity&quot;</span><span class="p">,</span>
            <span class="n">max_hours</span><span class="o">=</span><span class="n">FLOW_EP_RATIO</span><span class="p">,</span>
            <span class="n">capital_cost</span><span class="o">=</span><span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;flow battery power&quot;</span><span class="p">,</span> <span class="s2">&quot;capital_cost&quot;</span><span class="p">]</span>
            <span class="o">+</span> <span class="n">FLOW_EP_RATIO</span> <span class="o">*</span> <span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;flow battery energy&quot;</span><span class="p">,</span> <span class="s2">&quot;capital_cost&quot;</span><span class="p">],</span>
            <span class="n">efficiency_store</span><span class="o">=</span><span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;flow battery power&quot;</span><span class="p">,</span> <span class="s2">&quot;efficiency&quot;</span><span class="p">],</span>
            <span class="n">efficiency_dispatch</span><span class="o">=</span><span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;flow battery power&quot;</span><span class="p">,</span> <span class="s2">&quot;efficiency&quot;</span><span class="p">],</span>
            <span class="n">p_nom_extendable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">cyclic_state_of_charge</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">n</span>
</pre></div>
</div>
</div>
</div>
<section id="baseline-scenario-analysis">
<h3>Baseline scenario analysis<a class="headerlink" href="#baseline-scenario-analysis" title="Link to this heading">#</a></h3>
<p>For the baseline scenario, we assume only lithium ion batteries to be available.</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># load the cost data</span>
<span class="n">COSTS_FP</span> <span class="o">=</span> <span class="s2">&quot;data/costs.csv&quot;</span>
<span class="n">SOLVER_OPTIONS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;primal_feasibility_tolerance&quot;</span><span class="p">:</span> <span class="mf">1e-5</span><span class="p">,</span>
    <span class="s2">&quot;dual_feasibility_tolerance&quot;</span><span class="p">:</span> <span class="mf">1e-5</span><span class="p">,</span>
<span class="p">}</span>
<span class="c1"># we decrease the tolerance to speed up the optimization (default is 1e-7)</span>

<span class="n">costs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">COSTS_FP</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">n</span> <span class="o">=</span> <span class="n">create_network</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">costs</span><span class="p">,</span> <span class="n">add_flow_battery</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">n</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span>
    <span class="n">solver_name</span><span class="o">=</span><span class="s2">&quot;highs&quot;</span><span class="p">,</span>
    <span class="n">solver_options</span><span class="o">=</span><span class="n">SOLVER_OPTIONS</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/thesethtruth/.cache/pypoetry/virtualenvs/esi-course-6syH-QiP-py3.12/lib/python3.12/site-packages/pypsa/io.py:1096: FutureWarning: Downcasting object dtype arrays on .fillna, .ffill, .bfill is deprecated and will change in a future version. Call result.infer_objects(copy=False) instead. To opt-in to the future behavior, set `pd.set_option(&#39;future.no_silent_downcasting&#39;, True)`
  df = df.fillna(attrs[&quot;default&quot;].to_dict())
/home/thesethtruth/.cache/pypoetry/virtualenvs/esi-course-6syH-QiP-py3.12/lib/python3.12/site-packages/pypsa/io.py:1096: FutureWarning: Downcasting object dtype arrays on .fillna, .ffill, .bfill is deprecated and will change in a future version. Call result.infer_objects(copy=False) instead. To opt-in to the future behavior, set `pd.set_option(&#39;future.no_silent_downcasting&#39;, True)`
  df = df.fillna(attrs[&quot;default&quot;].to_dict())
WARNING:pypsa.consistency:The following buses have carriers which are not defined:
Index([&#39;electricity&#39;], dtype=&#39;object&#39;, name=&#39;Bus&#39;)
WARNING:pypsa.consistency:The following buses have carriers which are not defined:
Index([&#39;electricity&#39;], dtype=&#39;object&#39;, name=&#39;Bus&#39;)
/home/thesethtruth/.cache/pypoetry/virtualenvs/esi-course-6syH-QiP-py3.12/lib/python3.12/site-packages/linopy/common.py:154: UserWarning: coords for dimension(s) [&#39;Generator&#39;] is not aligned with the pandas object. Previously, the indexes of the pandas were ignored and overwritten in these cases. Now, the pandas object&#39;s coordinates are taken considered for alignment.
  warn(
INFO:linopy.model: Solve problem using Highs solver
INFO:linopy.model:Solver options:
 - primal_feasibility_tolerance: 1e-05
 - dual_feasibility_tolerance: 1e-05
INFO:linopy.io:Writing objective.
Writing constraints.: 100%|██████████| 16/16 [00:00&lt;00:00, 41.47it/s]
Writing continuous variables.: 100%|██████████| 6/6 [00:00&lt;00:00, 99.18it/s]
INFO:linopy.io: Writing time: 0.47s
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running HiGHS 1.8.1 (git hash: 4a7f24a): Copyright (c) 2024 HiGHS under MIT licence terms
Coefficient ranges:
  Matrix [1e-03, 6e+00]
  Cost   [5e-01, 2e+03]
  Bound  [0e+00, 0e+00]
  RHS    [2e+04, 1e+05]
Presolving model
56913 rows, 39396 cols, 144459 nonzeros  0s
56913 rows, 39396 cols, 144459 nonzeros  0s
Presolve : Reductions: rows 56913(-48210); columns 39396(-4407); elements 144459(-52617)
Solving the presolved LP
Using EKK dual simplex solver - serial
  Iteration        Objective     Infeasibilities num(sum)
          0     0.0000000000e+00 Pr: 8760(2.88434e+08) 0s
      17392     8.3806783045e+08 Pr: 12032(1.38802e+11); Du: 0(0.000685959) 5s
      36450     1.2025215527e+09 Pr: 0(0); Du: 0(1.21225e-12) 10s
Solving the original LP from the solution after postsolve
Model name          : linopy-problem-jr192ado
Model status        : Optimal
Simplex   iterations: 36450
Objective value     :  1.2025215527e+09
Relative P-D gap    :  2.7757174913e-15
HiGHS run time      :         10.36
Writing the solution to /tmp/linopy-solve-5rhrhsfp.sol
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:linopy.constants: Optimization successful: 
Status: ok
Termination condition: optimal
Solution: 43803 primals, 105123 duals
Objective: 1.20e+09
Solver model: available
Solver message: optimal

INFO:pypsa.optimization.optimize:The shadow-prices of the constraints Generator-ext-p-lower, Generator-ext-p-upper, StorageUnit-ext-p_dispatch-lower, StorageUnit-ext-p_dispatch-upper, StorageUnit-ext-p_store-lower, StorageUnit-ext-p_store-upper, StorageUnit-ext-state_of_charge-lower, StorageUnit-ext-state_of_charge-upper, StorageUnit-energy_balance were not assigned to the network.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&#39;ok&#39;, &#39;optimal&#39;)
</pre></div>
</div>
</div>
</details>
</div>
<section id="plot-the-energy-system-configuration">
<h4>Plot the energy system configuration<a class="headerlink" href="#plot-the-energy-system-configuration" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>

<span class="n">capacity_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">n</span><span class="o">.</span><span class="n">generators</span><span class="o">.</span><span class="n">p_nom_opt</span><span class="p">,</span>
        <span class="n">n</span><span class="o">.</span><span class="n">storage_units</span><span class="o">.</span><span class="n">p_nom_opt</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="mf">1e3</span><span class="p">)</span>

<span class="n">capacity_data</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;generation&quot;</span><span class="p">,</span> <span class="s2">&quot;storage&quot;</span><span class="p">]</span>

<span class="n">capacity_data</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s2">&quot;barh&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Installed Capacities: Baseline scenario&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Capacity (GW)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Capacity (GW)&#39;)
</pre></div>
</div>
<img alt="_images/1574a3a3ed7fed7c6feafeb1e53379af597112dfc9aa75106ddba4f1ba5ba789.png" src="_images/1574a3a3ed7fed7c6feafeb1e53379af597112dfc9aa75106ddba4f1ba5ba789.png" />
</div>
</div>
<p>The baseline scenario shows very large capacities;</p>
<ul class="simple">
<li><p>500 GW solar</p></li>
<li><p>230 GW wind</p></li>
<li><p>and 130 GW storage</p></li>
</ul>
<p>These values exceed what could physically fit in the Netherlands. This oversizing occurs because our model treats the Netherlands as an isolated system without connections to neighboring countries, requiring full self-sufficiency in power generation.</p>
</section>
</section>
<section id="baseline-with-renewable-generation-limits">
<h3>Baseline with renewable generation limits<a class="headerlink" href="#baseline-with-renewable-generation-limits" title="Link to this heading">#</a></h3>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="n">create_network</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">costs</span><span class="p">,</span> <span class="n">add_flow_battery</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">limit_renewable_energy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">n</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span>
    <span class="n">solver_name</span><span class="o">=</span><span class="s2">&quot;highs&quot;</span><span class="p">,</span>
    <span class="n">solver_options</span><span class="o">=</span><span class="n">SOLVER_OPTIONS</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING:pypsa.consistency:The following buses have carriers which are not defined:
Index([&#39;electricity&#39;], dtype=&#39;object&#39;, name=&#39;Bus&#39;)
WARNING:pypsa.consistency:The following buses have carriers which are not defined:
Index([&#39;electricity&#39;], dtype=&#39;object&#39;, name=&#39;Bus&#39;)
/home/thesethtruth/.cache/pypoetry/virtualenvs/esi-course-6syH-QiP-py3.12/lib/python3.12/site-packages/linopy/common.py:154: UserWarning: coords for dimension(s) [&#39;Generator&#39;] is not aligned with the pandas object. Previously, the indexes of the pandas were ignored and overwritten in these cases. Now, the pandas object&#39;s coordinates are taken considered for alignment.
  warn(
INFO:linopy.model: Solve problem using Highs solver
INFO:linopy.model:Solver options:
 - primal_feasibility_tolerance: 1e-05
 - dual_feasibility_tolerance: 1e-05
INFO:linopy.io:Writing objective.
Writing constraints.: 100%|██████████| 16/16 [00:00&lt;00:00, 42.99it/s]
Writing continuous variables.: 100%|██████████| 6/6 [00:00&lt;00:00, 82.10it/s]
INFO:linopy.io: Writing time: 0.48s
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running HiGHS 1.8.1 (git hash: 4a7f24a): Copyright (c) 2024 HiGHS under MIT licence terms
Coefficient ranges:
  Matrix [1e-03, 6e+00]
  Cost   [5e-01, 2e+03]
  Bound  [0e+00, 0e+00]
  RHS    [2e+04, 3e+05]
Presolving model
56913 rows, 39396 cols, 144459 nonzeros  0s
56913 rows, 39396 cols, 144459 nonzeros  0s
Presolve : Reductions: rows 56913(-48212); columns 39396(-4407); elements 144459(-52619)
Solving the presolved LP
Using EKK dual simplex solver - serial
  Iteration        Objective     Infeasibilities num(sum)
          0     0.0000000000e+00 Pr: 8760(2.88434e+08) 0s
      22648     1.0572706864e+09 Pr: 9883(7.01578e+10); Du: 0(0.00171288) 5s
      31363     1.2643315278e+09 Pr: 2006(3.50648e+07); Du: 0(0.00374069) 11s
      39571     1.7644238200e+09 Pr: 0(0); Du: 0(6.7335e-13) 11s
Solving the original LP from the solution after postsolve
Model name          : linopy-problem-b6c1or7u
Model status        : Optimal
Simplex   iterations: 39571
Objective value     :  1.7644238200e+09
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:linopy.constants: Optimization successful: 
Status: ok
Termination condition: optimal
Solution: 43803 primals, 105125 duals
Objective: 1.76e+09
Solver model: available
Solver message: optimal

INFO:pypsa.optimization.optimize:The shadow-prices of the constraints Generator-ext-p-lower, Generator-ext-p-upper, StorageUnit-ext-p_dispatch-lower, StorageUnit-ext-p_dispatch-upper, StorageUnit-ext-p_store-lower, StorageUnit-ext-p_store-upper, StorageUnit-ext-state_of_charge-lower, StorageUnit-ext-state_of_charge-upper, StorageUnit-energy_balance were not assigned to the network.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Relative P-D gap    :  2.9051973753e-14
HiGHS run time      :         10.96
Writing the solution to /tmp/linopy-solve-anmbhe_6.sol
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&#39;ok&#39;, &#39;optimal&#39;)
</pre></div>
</div>
</div>
</details>
</div>
<section id="id1">
<h4>Plot the energy system configuration<a class="headerlink" href="#id1" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>

<span class="n">capacity_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">n</span><span class="o">.</span><span class="n">generators</span><span class="o">.</span><span class="n">p_nom_opt</span><span class="p">,</span>
        <span class="n">n</span><span class="o">.</span><span class="n">storage_units</span><span class="o">.</span><span class="n">p_nom_opt</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="mf">1e3</span><span class="p">)</span>

<span class="n">capacity_data</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;generation&quot;</span><span class="p">,</span> <span class="s2">&quot;storage&quot;</span><span class="p">]</span>

<span class="n">capacity_data</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s2">&quot;barh&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Installed Capacities: Baseline with limited renewable energy&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Capacity (GW)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Capacity (GW)&#39;)
</pre></div>
</div>
<img alt="_images/dc5148284125c7027c46172d81070d5135b3198f13ceb95b8fe058824b535a81.png" src="_images/dc5148284125c7027c46172d81070d5135b3198f13ceb95b8fe058824b535a81.png" />
</div>
</div>
</section>
<section id="impact-of-generation-capacity-limits">
<h4>Impact of generation capacity limits<a class="headerlink" href="#impact-of-generation-capacity-limits" title="Link to this heading">#</a></h4>
<p>With upper limits applied to renewable generation, we see:</p>
<ul class="simple">
<li><p>300 GW solar (at limit)</p></li>
<li><p>150 GW (at limit)</p></li>
<li><p>480 GW lithium-ion battery storage</p></li>
</ul>
<p>The model responds to these generation constraints by heavily investing in storage capacity. This shift reveals a key system dynamic: when prevented from oversizing generation, the model compensates with massive storage deployment. However, with lithium-ion batteries limited to 6 hours of storage duration, this solution may struggle to bridge extended periods of low renewable generation, suggesting the need for longer-duration storage technologies.</p>
</section>
</section>
<section id="baseline-with-renewable-generation-limits-and-flow-battery-scenario">
<h3>Baseline with renewable generation limits and flow battery scenario<a class="headerlink" href="#baseline-with-renewable-generation-limits-and-flow-battery-scenario" title="Link to this heading">#</a></h3>
<p>In this scenario, in addition to the upper limit imposed on renewable energy generation we also assume also flow batteries are available for energy storage.</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="n">create_network</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">costs</span><span class="p">,</span> <span class="n">add_flow_battery</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">limit_renewable_energy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">n</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span>
    <span class="n">solver_name</span><span class="o">=</span><span class="s2">&quot;highs&quot;</span><span class="p">,</span>
    <span class="n">solver_options</span><span class="o">=</span><span class="n">SOLVER_OPTIONS</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING:pypsa.consistency:The following buses have carriers which are not defined:
Index([&#39;electricity&#39;], dtype=&#39;object&#39;, name=&#39;Bus&#39;)
WARNING:pypsa.consistency:The following buses have carriers which are not defined:
Index([&#39;electricity&#39;], dtype=&#39;object&#39;, name=&#39;Bus&#39;)
/home/thesethtruth/.cache/pypoetry/virtualenvs/esi-course-6syH-QiP-py3.12/lib/python3.12/site-packages/linopy/common.py:154: UserWarning: coords for dimension(s) [&#39;Generator&#39;] is not aligned with the pandas object. Previously, the indexes of the pandas were ignored and overwritten in these cases. Now, the pandas object&#39;s coordinates are taken considered for alignment.
  warn(
INFO:linopy.model: Solve problem using Highs solver
INFO:linopy.model:Solver options:
 - primal_feasibility_tolerance: 1e-05
 - dual_feasibility_tolerance: 1e-05
INFO:linopy.io:Writing objective.
Writing constraints.: 100%|██████████| 16/16 [00:00&lt;00:00, 27.36it/s]
Writing continuous variables.: 100%|██████████| 6/6 [00:00&lt;00:00, 62.17it/s]
INFO:linopy.io: Writing time: 0.7s
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running HiGHS 1.8.1 (git hash: 4a7f24a): Copyright (c) 2024 HiGHS under MIT licence terms
Coefficient ranges:
  Matrix [1e-03, 1e+02]
  Cost   [5e-01, 3e+03]
  Bound  [0e+00, 0e+00]
  RHS    [2e+04, 3e+05]
Presolving model
91953 rows, 65677 cols, 249579 nonzeros  0s
91953 rows, 65677 cols, 249579 nonzeros  0s
Presolve : Reductions: rows 91953(-74493); columns 65677(-4407); elements 249579(-78900)
Solving the presolved LP
Using EKK dual simplex solver - serial
  Iteration        Objective     Infeasibilities num(sum)
          0     0.0000000000e+00 Pr: 8760(4.83545e+08) 0s
      12160     1.8623553094e+08 Pr: 14874(3.04767e+10); Du: 0(0.00164249) 6s
      17198     1.8718267060e+08 Pr: 17058(7.99661e+10); Du: 0(0.00204629) 11s
      21942     1.8843983537e+08 Pr: 19082(1.40572e+11); Du: 0(0.00272412) 17s
      25860     1.8951551343e+08 Pr: 20686(1.90755e+11); Du: 0(0.00344047) 23s
      28739     3.1744926814e+08 Pr: 21302(2.66921e+11); Du: 0(0.00379979) 31s
      31281     3.6779305938e+08 Pr: 21078(7.42084e+10); Du: 0(0.00353308) 36s
      34243     5.8487688436e+08 Pr: 37451(9.3575e+11); Du: 0(0.00281197) 42s
      38652     6.3551931227e+08 Pr: 17331(1.10048e+11); Du: 0(0.00264149) 47s
      45183     9.2581428389e+08 Pr: 36514(2.68435e+10); Du: 0(0.00390185) 54s
      54384     1.0985648279e+09 Pr: 14907(2.37384e+09); Du: 0(0.00450506) 60s
      64289     1.1577672564e+09 Pr: 3050(1.17193e+08); Du: 0(0.00353224) 66s
      76312     1.1844667613e+09 Pr: 0(0); Du: 0(7.02838e-12) 70s
Solving the original LP from the solution after postsolve
Model name          : linopy-problem-84l_bh4r
Model status        : Optimal
Simplex   iterations: 76312
Objective value     :  1.1844667613e+09
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:linopy.constants: Optimization successful: 
Status: ok
Termination condition: optimal
Solution: 70084 primals, 166446 duals
Objective: 1.18e+09
Solver model: available
Solver message: optimal

INFO:pypsa.optimization.optimize:The shadow-prices of the constraints Generator-ext-p-lower, Generator-ext-p-upper, StorageUnit-ext-p_dispatch-lower, StorageUnit-ext-p_dispatch-upper, StorageUnit-ext-p_store-lower, StorageUnit-ext-p_store-upper, StorageUnit-ext-state_of_charge-lower, StorageUnit-ext-state_of_charge-upper, StorageUnit-energy_balance were not assigned to the network.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Relative P-D gap    :  7.4476445564e-15
HiGHS run time      :         69.70
Writing the solution to /tmp/linopy-solve-afoddizw.sol
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&#39;ok&#39;, &#39;optimal&#39;)
</pre></div>
</div>
</div>
</details>
</div>
<section id="id2">
<h4>Plot the energy system configuration<a class="headerlink" href="#id2" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>

<span class="n">capacity_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">n</span><span class="o">.</span><span class="n">generators</span><span class="o">.</span><span class="n">p_nom_opt</span><span class="p">,</span>
        <span class="n">n</span><span class="o">.</span><span class="n">storage_units</span><span class="o">.</span><span class="n">p_nom_opt</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="mf">1e3</span><span class="p">)</span>

<span class="n">capacity_data</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;generation&quot;</span><span class="p">,</span> <span class="s2">&quot;storage&quot;</span><span class="p">]</span>

<span class="n">capacity_data</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s2">&quot;barh&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Installed Capacities: Baseline with LDES and limited renewable energy&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Capacity (GW)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Capacity (GW)&#39;)
</pre></div>
</div>
<img alt="_images/e73de76336a07e21e709d73b80bd8264aa5603c031a69d922ad12b05de9276cd.png" src="_images/e73de76336a07e21e709d73b80bd8264aa5603c031a69d922ad12b05de9276cd.png" />
</div>
</div>
</section>
<section id="impact-of-adding-long-duration-energy-storage">
<h4>Impact of adding long-duration energy storage<a class="headerlink" href="#impact-of-adding-long-duration-energy-storage" title="Link to this heading">#</a></h4>
<p>After adding flow batteries (100-hour storage duration), the model selects:</p>
<ul class="simple">
<li><p>300 GW solar (at limit)</p></li>
<li><p>150 GW wind (at limit)</p></li>
<li><p>80 GW battery electric storage</p></li>
<li><p>40 GW flow battery storage</p></li>
</ul>
<p>The introduction of long-duration energy storage (LDES) reduces the need for short-duration batteries by about 80%. The model opts for a mix of both storage types, using flow batteries to manage multi-day supply gaps while keeping some battery capacity for daily cycling. This more diversified storage portfolio better matches the temporal patterns of renewable generation.</p>
</section>
</section>
</section>
<section id="sensitivity-analysis">
<h2>Sensitivity analysis<a class="headerlink" href="#sensitivity-analysis" title="Link to this heading">#</a></h2>
<section id="define-scenarios-and-run-the-optimisation-problems">
<h3>Define scenarios and run the optimisation problems<a class="headerlink" href="#define-scenarios-and-run-the-optimisation-problems" title="Link to this heading">#</a></h3>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create and solve networks with different cost scenarios</span>
<span class="n">scenarios</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;baseline&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
    <span class="s2">&quot;expensive_generation&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
    <span class="s2">&quot;expensive_storage&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">),</span>
<span class="p">}</span>

<span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="p">(</span><span class="n">gen_mult</span><span class="p">,</span> <span class="n">store_mult</span><span class="p">)</span> <span class="ow">in</span> <span class="n">scenarios</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">create_network</span><span class="p">(</span>
        <span class="n">ts</span><span class="p">,</span>
        <span class="n">costs</span><span class="p">,</span>
        <span class="n">gen_mult</span><span class="p">,</span>
        <span class="n">store_mult</span><span class="p">,</span>
        <span class="n">add_flow_battery</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">limit_renewable_energy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">n</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">solver_name</span><span class="o">=</span><span class="s2">&quot;highs&quot;</span><span class="p">,</span> <span class="n">solver_options</span><span class="o">=</span><span class="n">SOLVER_OPTIONS</span><span class="p">)</span>
    <span class="n">results</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING:pypsa.consistency:The following buses have carriers which are not defined:
Index([&#39;electricity&#39;], dtype=&#39;object&#39;, name=&#39;Bus&#39;)
WARNING:pypsa.consistency:The following buses have carriers which are not defined:
Index([&#39;electricity&#39;], dtype=&#39;object&#39;, name=&#39;Bus&#39;)
/home/thesethtruth/.cache/pypoetry/virtualenvs/esi-course-6syH-QiP-py3.12/lib/python3.12/site-packages/linopy/common.py:154: UserWarning: coords for dimension(s) [&#39;Generator&#39;] is not aligned with the pandas object. Previously, the indexes of the pandas were ignored and overwritten in these cases. Now, the pandas object&#39;s coordinates are taken considered for alignment.
  warn(
INFO:linopy.model: Solve problem using Highs solver
INFO:linopy.model:Solver options:
 - primal_feasibility_tolerance: 1e-05
 - dual_feasibility_tolerance: 1e-05
INFO:linopy.io:Writing objective.
Writing constraints.: 100%|██████████| 16/16 [00:00&lt;00:00, 27.89it/s]
Writing continuous variables.: 100%|██████████| 6/6 [00:00&lt;00:00, 59.46it/s]
INFO:linopy.io: Writing time: 0.7s
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running HiGHS 1.8.1 (git hash: 4a7f24a): Copyright (c) 2024 HiGHS under MIT licence terms
Coefficient ranges:
  Matrix [1e-03, 1e+02]
  Cost   [5e-01, 3e+03]
  Bound  [0e+00, 0e+00]
  RHS    [2e+04, 3e+05]
Presolving model
91953 rows, 65677 cols, 249579 nonzeros  0s
91953 rows, 65677 cols, 249579 nonzeros  0s
Presolve : Reductions: rows 91953(-74493); columns 65677(-4407); elements 249579(-78900)
Solving the presolved LP
Using EKK dual simplex solver - serial
  Iteration        Objective     Infeasibilities num(sum)
          0     0.0000000000e+00 Pr: 8760(4.83545e+08) 0s
      12160     1.8623553094e+08 Pr: 14874(3.04767e+10); Du: 0(0.00164249) 6s
      18075     1.8738298523e+08 Pr: 17422(9.16745e+10); Du: 0(0.00227149) 11s
      23161     1.8881790897e+08 Pr: 19606(1.58739e+11); Du: 0(0.00280235) 17s
      27088     1.8986007861e+08 Pr: 21214(2.07089e+11); Du: 0(0.00374331) 23s
      28739     3.1744926814e+08 Pr: 21302(2.66921e+11); Du: 0(0.00379979) 29s
      31281     3.6779305938e+08 Pr: 21078(7.42084e+10); Du: 0(0.00353308) 35s
      34243     5.8487688436e+08 Pr: 37451(9.3575e+11); Du: 0(0.00281197) 40s
      38652     6.3551931227e+08 Pr: 17331(1.10048e+11); Du: 0(0.00264149) 46s
      44248     8.2510192110e+08 Pr: 17787(1.64779e+10); Du: 0(0.00397365) 52s
      49751     1.0131698839e+09 Pr: 32853(5.91491e+09); Du: 0(0.00406809) 57s
      58469     1.1310300563e+09 Pr: 5691(4.20632e+08); Du: 0(0.00401105) 65s
      72840     1.1814921064e+09 Pr: 1640(1.93166e+07); Du: 0(0.00526611) 71s
      76312     1.1844667613e+09 Pr: 0(0); Du: 0(7.02838e-12) 72s
Solving the original LP from the solution after postsolve
Model name          : linopy-problem-2jquwdks
Model status        : Optimal
Simplex   iterations: 76312
Objective value     :  1.1844667613e+09
Relative P-D gap    :  7.4476445564e-15
HiGHS run time      :         71.85
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:linopy.constants: Optimization successful: 
Status: ok
Termination condition: optimal
Solution: 70084 primals, 166446 duals
Objective: 1.18e+09
Solver model: available
Solver message: optimal

INFO:pypsa.optimization.optimize:The shadow-prices of the constraints Generator-ext-p-lower, Generator-ext-p-upper, StorageUnit-ext-p_dispatch-lower, StorageUnit-ext-p_dispatch-upper, StorageUnit-ext-p_store-lower, StorageUnit-ext-p_store-upper, StorageUnit-ext-state_of_charge-lower, StorageUnit-ext-state_of_charge-upper, StorageUnit-energy_balance were not assigned to the network.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing the solution to /tmp/linopy-solve-igi72umu.sol
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING:pypsa.consistency:The following buses have carriers which are not defined:
Index([&#39;electricity&#39;], dtype=&#39;object&#39;, name=&#39;Bus&#39;)
WARNING:pypsa.consistency:The following buses have carriers which are not defined:
Index([&#39;electricity&#39;], dtype=&#39;object&#39;, name=&#39;Bus&#39;)
/home/thesethtruth/.cache/pypoetry/virtualenvs/esi-course-6syH-QiP-py3.12/lib/python3.12/site-packages/linopy/common.py:154: UserWarning: coords for dimension(s) [&#39;Generator&#39;] is not aligned with the pandas object. Previously, the indexes of the pandas were ignored and overwritten in these cases. Now, the pandas object&#39;s coordinates are taken considered for alignment.
  warn(
INFO:linopy.model: Solve problem using Highs solver
INFO:linopy.model:Solver options:
 - primal_feasibility_tolerance: 1e-05
 - dual_feasibility_tolerance: 1e-05
INFO:linopy.io:Writing objective.
Writing constraints.: 100%|██████████| 16/16 [00:00&lt;00:00, 28.02it/s]
Writing continuous variables.: 100%|██████████| 6/6 [00:00&lt;00:00, 66.72it/s]
INFO:linopy.io: Writing time: 0.69s
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running HiGHS 1.8.1 (git hash: 4a7f24a): Copyright (c) 2024 HiGHS under MIT licence terms
Coefficient ranges:
  Matrix [1e-03, 1e+02]
  Cost   [5e-01, 3e+03]
  Bound  [0e+00, 0e+00]
  RHS    [2e+04, 3e+05]
Presolving model
91953 rows, 65677 cols, 249579 nonzeros  0s
91953 rows, 65677 cols, 249579 nonzeros  0s
Presolve : Reductions: rows 91953(-74493); columns 65677(-4407); elements 249579(-78900)
Solving the presolved LP
Using EKK dual simplex solver - serial
  Iteration        Objective     Infeasibilities num(sum)
          0     0.0000000000e+00 Pr: 8760(4.83545e+08) 0s
      12154     1.8629435974e+08 Pr: 14919(2.6928e+10); Du: 0(0.00161685) 6s
      17486     1.8747845492e+08 Pr: 17240(8.07018e+10); Du: 0(0.00220029) 11s
      22167     1.8899507311e+08 Pr: 19197(1.41553e+11); Du: 0(0.00276781) 16s
      26578     1.9089992278e+08 Pr: 21124(2.26527e+11); Du: 0(0.00285984) 26s
      29890     3.4561171789e+08 Pr: 21653(1.36529e+11); Du: 0(0.00317713) 32s
      33581     3.7300537692e+08 Pr: 21521(1.98926e+11); Du: 0(0.0026611) 37s
      35501     6.8653366632e+08 Pr: 17395(2.70996e+10); Du: 0(0.00262549) 43s
      38459     9.2146333615e+08 Pr: 34665(2.76269e+10); Du: 0(0.00255441) 49s
      43425     1.0379168700e+09 Pr: 34471(4.58596e+10); Du: 0(0.00336107) 56s
      45541     1.0725731154e+09 Pr: 34647(4.80194e+10); Du: 0(0.00346386) 62s
      51089     1.2588116694e+09 Pr: 12861(2.38788e+09); Du: 0(0.00310731) 68s
      56524     1.3764401555e+09 Pr: 7566(1.2695e+09); Du: 0(0.00308137) 73s
      62344     1.4633140902e+09 Pr: 2423(4.93041e+07); Du: 0(0.00439701) 79s
      64597     1.4694272694e+09 Pr: 0(0); Du: 0(3.39427e-11) 81s
      64597     1.4694272694e+09 Pr: 0(0); Du: 0(3.39427e-11) 81s
Solving the original LP from the solution after postsolve
Model name          : linopy-problem-1nx5v352
Model status        : Optimal
Simplex   iterations: 64597
Objective value     :  1.4694272694e+09
Relative P-D gap    :  5.1920872098e-15
HiGHS run time      :         81.12
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:linopy.constants: Optimization successful: 
Status: ok
Termination condition: optimal
Solution: 70084 primals, 166446 duals
Objective: 1.47e+09
Solver model: available
Solver message: optimal

INFO:pypsa.optimization.optimize:The shadow-prices of the constraints Generator-ext-p-lower, Generator-ext-p-upper, StorageUnit-ext-p_dispatch-lower, StorageUnit-ext-p_dispatch-upper, StorageUnit-ext-p_store-lower, StorageUnit-ext-p_store-upper, StorageUnit-ext-state_of_charge-lower, StorageUnit-ext-state_of_charge-upper, StorageUnit-energy_balance were not assigned to the network.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing the solution to /tmp/linopy-solve-i6qfaceh.sol
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING:pypsa.consistency:The following buses have carriers which are not defined:
Index([&#39;electricity&#39;], dtype=&#39;object&#39;, name=&#39;Bus&#39;)
WARNING:pypsa.consistency:The following buses have carriers which are not defined:
Index([&#39;electricity&#39;], dtype=&#39;object&#39;, name=&#39;Bus&#39;)
/home/thesethtruth/.cache/pypoetry/virtualenvs/esi-course-6syH-QiP-py3.12/lib/python3.12/site-packages/linopy/common.py:154: UserWarning: coords for dimension(s) [&#39;Generator&#39;] is not aligned with the pandas object. Previously, the indexes of the pandas were ignored and overwritten in these cases. Now, the pandas object&#39;s coordinates are taken considered for alignment.
  warn(
INFO:linopy.model: Solve problem using Highs solver
INFO:linopy.model:Solver options:
 - primal_feasibility_tolerance: 1e-05
 - dual_feasibility_tolerance: 1e-05
INFO:linopy.io:Writing objective.
Writing constraints.: 100%|██████████| 16/16 [00:00&lt;00:00, 26.07it/s]
Writing continuous variables.: 100%|██████████| 6/6 [00:00&lt;00:00, 58.14it/s]
INFO:linopy.io: Writing time: 0.74s
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running HiGHS 1.8.1 (git hash: 4a7f24a): Copyright (c) 2024 HiGHS under MIT licence terms
Coefficient ranges:
  Matrix [1e-03, 1e+02]
  Cost   [5e-01, 4e+03]
  Bound  [0e+00, 0e+00]
  RHS    [2e+04, 3e+05]
Presolving model
91953 rows, 65677 cols, 249579 nonzeros  0s
91953 rows, 65677 cols, 249579 nonzeros  0s
Presolve : Reductions: rows 91953(-74493); columns 65677(-4407); elements 249579(-78900)
Solving the presolved LP
Using EKK dual simplex solver - serial
  Iteration        Objective     Infeasibilities num(sum)
          0     0.0000000000e+00 Pr: 8760(4.83545e+08) 0s
      12703     2.0489470433e+08 Pr: 13108(6.74711e+10); Du: 0(0.000110946) 6s
      16219     2.0639473589e+08 Pr: 14226(1.25799e+11); Du: 0(0.000113852) 12s
      20599     2.0876460028e+08 Pr: 15557(2.17646e+11); Du: 0(6.5762e-05) 17s
      24885     2.1180214621e+08 Pr: 16805(3.37596e+11); Du: 0(2.87633e-05) 22s
      28780     3.6006370339e+08 Pr: 22921(8.00132e+09); Du: 0(0.000254273) 28s
      32743     7.0655272102e+08 Pr: 35444(5.189e+10); Du: 0(0.00108661) 35s
      37263     8.3214993063e+08 Pr: 35309(2.11233e+10); Du: 0(0.0015753) 41s
      39920     8.5589755519e+08 Pr: 20430(1.62566e+10); Du: 0(0.00211412) 50s
      42957     9.1996282976e+08 Pr: 34670(2.82353e+10); Du: 0(0.00245885) 56s
      46898     9.7758558247e+08 Pr: 17530(7.7805e+09); Du: 0(0.0029493) 61s
      51334     1.0595044871e+09 Pr: 14641(9.76205e+09); Du: 0(0.00327851) 66s
      56623     1.1927766045e+09 Pr: 33264(1.46378e+10); Du: 0(0.00323071) 72s
      62079     1.2694809687e+09 Pr: 14228(4.87321e+09); Du: 0(0.00450072) 78s
      64547     1.3397520990e+09 Pr: 12356(2.37925e+09); Du: 0(0.00452715) 84s
      69694     1.4799065430e+09 Pr: 36689(8.19745e+09); Du: 0(0.00480656) 90s
      73479     1.5311009901e+09 Pr: 5398(3.80298e+08); Du: 0(0.00532698) 95s
      78428     1.5646680992e+09 Pr: 4826(1.59483e+09); Du: 0(0.00574353) 102s
      79839     1.5662568840e+09 Pr: 0(0); Du: 0(1.7585e-10) 103s
Solving the original LP from the solution after postsolve
Model name          : linopy-problem-1w46vs78
Model status        : Optimal
Simplex   iterations: 79839
Objective value     :  1.5662568840e+09
Relative P-D gap    :  8.9810913591e-15
HiGHS run time      :        103.64
Writing the solution to /tmp/linopy-solve-e108d6c5.sol
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:linopy.constants: Optimization successful: 
Status: ok
Termination condition: optimal
Solution: 70084 primals, 166446 duals
Objective: 1.57e+09
Solver model: available
Solver message: optimal

INFO:pypsa.optimization.optimize:The shadow-prices of the constraints Generator-ext-p-lower, Generator-ext-p-upper, StorageUnit-ext-p_dispatch-lower, StorageUnit-ext-p_dispatch-upper, StorageUnit-ext-p_store-lower, StorageUnit-ext-p_store-upper, StorageUnit-ext-state_of_charge-lower, StorageUnit-ext-state_of_charge-upper, StorageUnit-energy_balance were not assigned to the network.
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="results-visualisation">
<h3>Results visualisation<a class="headerlink" href="#results-visualisation" title="Link to this heading">#</a></h3>
<p>Let’s visualise the results so we can compare the results from our different scenarios.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>

<span class="c1"># Capacity comparison</span>
<span class="n">capacity_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="k">for</span> <span class="n">scenario</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">caps</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">n</span><span class="o">.</span><span class="n">generators</span><span class="o">.</span><span class="n">p_nom_opt</span><span class="p">,</span> <span class="n">n</span><span class="o">.</span><span class="n">storage_units</span><span class="o">.</span><span class="n">p_nom_opt</span><span class="p">])</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
        <span class="n">scenario</span>
    <span class="p">)</span>
    <span class="n">capacity_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">capacity_data</span><span class="p">,</span> <span class="n">caps</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># convert to GW</span>
<span class="n">capacity_data</span> <span class="o">=</span> <span class="n">capacity_data</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="mf">1e3</span><span class="p">)</span>
<span class="c1"># make scenario names pretty</span>
<span class="n">capacity_data</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">capacity_data</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>

<span class="n">capacity_data</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s2">&quot;barh&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Installed Capacities by scenario&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Capacity (GW)&quot;</span><span class="p">)</span>

<span class="c1"># Add data call outs</span>
<span class="k">for</span> <span class="n">container</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">containers</span><span class="p">:</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">bar_label</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.0f</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">label_type</span><span class="o">=</span><span class="s1">&#39;edge&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="c1"># Cost comparison</span>
<span class="n">cost_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">n</span><span class="o">.</span><span class="n">objective</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">items</span><span class="p">()},</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Relative System Cost&quot;</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="mf">1e9</span><span class="p">)</span>

<span class="c1"># Normalize to baseline</span>
<span class="n">cost_data</span> <span class="o">=</span> <span class="n">cost_data</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">cost_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;baseline&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="c1"># make index pretty</span>
<span class="n">cost_data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">cost_data</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>

<span class="n">cost_data</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s2">&quot;barh&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Relative system cost by scenario&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Relative cost (%)&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">container</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">containers</span><span class="p">:</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">bar_label</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%.0f%%</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">label_type</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/9c8e411f1a32c4cf0ec5fab781a44b1986335e4efc53ef18500ccc32c16c4502.png" src="_images/9c8e411f1a32c4cf0ec5fab781a44b1986335e4efc53ef18500ccc32c16c4502.png" />
</div>
</div>
</section>
<section id="sensitivity-analysis-results">
<h3>Sensitivity analysis results<a class="headerlink" href="#sensitivity-analysis-results" title="Link to this heading">#</a></h3>
<p>Comparing three cost scenarios reveals clear system adaptation patterns:</p>
<ul class="simple">
<li><p>In the baseline scenario (renewable and storage costs at reference values), the model deploys 150 GW wind, 300 GW solar, with a mixed storage portfolio of 51 GW batteries and 44 GW flow batteries.</p></li>
<li><p>When <strong>generation costs double</strong>, wind capacity slightly decreases to 143 GW while solar remains at its 300 GW limit. Storage capacities remain similar (50 GW batteries, 50 GW flow), suggesting storage deployment is relatively insensitive to generation costs. Total system costs increase by 30%.</p></li>
<li><p>With <strong>doubled storage costs</strong>, the model shifts notably. While solar remains capped and wind drops slightly to 140 GW, battery storage is completely phased out in favor of increased flow battery capacity (83 GW). This suggests flow batteries’ longer duration becomes more valuable when storage is expensive. The scenario results in the highest cost increase at 34% above baseline. Interestingly, the deployed wind capacity is more sensitive towards the costs of storage than towards the cost of generation.</p></li>
</ul>
</section>
</section>
<section id="detailed-analysis-of-system-dynamics">
<h2>Detailed analysis of system dynamics<a class="headerlink" href="#detailed-analysis-of-system-dynamics" title="Link to this heading">#</a></h2>
<p>We might be interested in specific system dynamics of one of the scenarios during a specific week. Remember the first chapter of this tutorial? We found that February has a long period of high demand due to heating. Let’s see how each of the energy system configurations fares during this period.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_timeseries</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">scenario_name</span><span class="p">,</span> <span class="n">week_start</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="n">week_slice</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">week_start</span> <span class="o">*</span> <span class="mi">168</span><span class="p">,</span> <span class="p">(</span><span class="n">week_start</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">168</span><span class="p">)</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

    <span class="c1"># slice the generation data</span>
    <span class="n">generation</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">generators_t</span><span class="o">.</span><span class="n">p_max_pu</span><span class="p">[</span><span class="n">week_slice</span><span class="p">]</span> <span class="o">*</span> <span class="n">network</span><span class="o">.</span><span class="n">generators</span><span class="o">.</span><span class="n">p_nom_opt</span>
    <span class="n">storage</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">storage_units_t</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">week_slice</span><span class="p">]</span>
    <span class="n">load</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">loads_t</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">week_slice</span><span class="p">]</span>

    <span class="c1"># extract the negative and positive parts of the storage</span>
    <span class="n">storage_negative</span> <span class="o">=</span> <span class="n">storage</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">storage_negative</span><span class="p">[</span><span class="n">storage</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">storage_negative</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2"> (discharging)&quot;</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">storage_negative</span><span class="o">.</span><span class="n">columns</span>
    <span class="p">]</span>

    <span class="n">storage_positive</span> <span class="o">=</span> <span class="n">storage</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">storage_positive</span><span class="p">[</span><span class="n">storage</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">storage_positive</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2"> (charging)&quot;</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">storage_positive</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>

    <span class="c1"># combine the parts to positive and negative timeseries (on the bus)</span>
    <span class="n">positives</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">generation</span><span class="p">,</span> <span class="n">storage_positive</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="mf">1e3</span><span class="p">)</span>
    <span class="n">negatives</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="o">-</span><span class="n">load</span><span class="p">,</span> <span class="n">storage_negative</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="mf">1e3</span><span class="p">)</span>

    <span class="n">curtailment</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">positives</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">negatives</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">curtailment</span><span class="p">[</span><span class="n">curtailment</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">curtailment</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;curtailment&quot;</span>

    <span class="n">negatives</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">negatives</span><span class="p">,</span> <span class="n">curtailment</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Define colors for each technology</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;wind&quot;</span><span class="p">:</span> <span class="s2">&quot;#4B90B9&quot;</span><span class="p">,</span>
        <span class="s2">&quot;solar&quot;</span><span class="p">:</span> <span class="s2">&quot;#E6B829&quot;</span><span class="p">,</span>
        <span class="s2">&quot;demand&quot;</span><span class="p">:</span> <span class="s2">&quot;#708090&quot;</span><span class="p">,</span>
        <span class="s2">&quot;battery storage (charging)&quot;</span><span class="p">:</span> <span class="s2">&quot;#9CAF88&quot;</span><span class="p">,</span>
        <span class="s2">&quot;battery storage (discharging)&quot;</span><span class="p">:</span> <span class="s2">&quot;#4A5D3F&quot;</span><span class="p">,</span>
        <span class="s2">&quot;flow battery (charging)&quot;</span><span class="p">:</span> <span class="s2">&quot;#9B8EA9&quot;</span><span class="p">,</span>
        <span class="s2">&quot;flow battery (discharging)&quot;</span><span class="p">:</span> <span class="s2">&quot;#563D67&quot;</span><span class="p">,</span>
        <span class="s2">&quot;curtailment&quot;</span><span class="p">:</span> <span class="s2">&quot;#B07979&quot;</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="c1"># Apply colors to the plots</span>
    <span class="n">positives</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;area&quot;</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="n">colors</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="s2">&quot;#333333&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">positives</span><span class="o">.</span><span class="n">columns</span><span class="p">],</span>
    <span class="p">)</span>
    <span class="n">negatives</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;area&quot;</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="n">colors</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="s2">&quot;#333333&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">negatives</span><span class="o">.</span><span class="n">columns</span><span class="p">],</span>
    <span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">250</span><span class="p">,</span> <span class="mi">250</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Power System Operation - Week </span><span class="si">{</span><span class="n">week_start</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">scenario_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Power (GW)&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Technology&quot;</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span>


<span class="n">fig</span> <span class="o">=</span> <span class="n">plot_timeseries</span><span class="p">(</span>
    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;baseline&quot;</span><span class="p">],</span> <span class="s2">&quot;Baseline&quot;</span><span class="p">,</span> <span class="n">week_start</span><span class="o">=</span><span class="mi">4</span>
<span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plot_timeseries</span><span class="p">(</span>
    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;expensive_generation&quot;</span><span class="p">],</span> <span class="s2">&quot;Expensive Generation&quot;</span><span class="p">,</span> <span class="n">week_start</span><span class="o">=</span><span class="mi">4</span>
<span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plot_timeseries</span><span class="p">(</span>
    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;expensive_storage&quot;</span><span class="p">],</span> <span class="s2">&quot;Expensive Storage&quot;</span><span class="p">,</span> <span class="n">week_start</span><span class="o">=</span><span class="mi">4</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/thesethtruth/.cache/pypoetry/virtualenvs/esi-course-6syH-QiP-py3.12/lib/python3.12/site-packages/pandas/plotting/_matplotlib/core.py:1800: UserWarning: Attempting to set identical low and high ylims makes transformation singular; automatically expanding.
  ax.set_ylim(None, 0)
/home/thesethtruth/.cache/pypoetry/virtualenvs/esi-course-6syH-QiP-py3.12/lib/python3.12/site-packages/pandas/plotting/_matplotlib/core.py:1800: UserWarning: Attempting to set identical low and high ylims makes transformation singular; automatically expanding.
  ax.set_ylim(None, 0)
/home/thesethtruth/.cache/pypoetry/virtualenvs/esi-course-6syH-QiP-py3.12/lib/python3.12/site-packages/pandas/plotting/_matplotlib/core.py:1800: UserWarning: Attempting to set identical low and high ylims makes transformation singular; automatically expanding.
  ax.set_ylim(None, 0)
</pre></div>
</div>
<img alt="_images/d33b56d0d756e49b4befb9e4dfd015fdc429de38633a294b862b6e54bab2f9df.png" src="_images/d33b56d0d756e49b4befb9e4dfd015fdc429de38633a294b862b6e54bab2f9df.png" />
<img alt="_images/e89af14bad7b2e1bf60d8cafe8750f266576f16b08b83463fb23099c9cbec82c.png" src="_images/e89af14bad7b2e1bf60d8cafe8750f266576f16b08b83463fb23099c9cbec82c.png" />
<img alt="_images/65a1412a5f88574fab0c43ccea5178824a0b5067a27b207160f4e6e788cc6e9e.png" src="_images/65a1412a5f88574fab0c43ccea5178824a0b5067a27b207160f4e6e788cc6e9e.png" />
</div>
</div>
</section>
<section id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>The addition of long-duration storage (flow battery) allows for better management of longer periods of low renewable generation.</p></li>
<li><p>Different cost scenarios lead to different optimal system configurations:</p>
<ul class="simple">
<li><p>Higher generation costs result in more storage capacity to make better use of available renewable energy</p></li>
<li><p>Higher storage costs push the system toward oversized generation capacity to reduce storage needs</p></li>
</ul>
</li>
<li><p>The baseline scenario represents a balanced approach between generation and storage.</p></li>
</ol>
</section>
<section id="next-steps">
<h2>Next steps<a class="headerlink" href="#next-steps" title="Link to this heading">#</a></h2>
<p>To extend this analysis, you could:</p>
<ol class="arabic simple">
<li><p>Add more technology options (e.g., different storage or dispatchables technologies)</p></li>
<li><p>Analyze seasonal patterns using the full year of data</p></li>
<li><p>Include more detailed cost components (fixed O&amp;M, variable O&amp;M, etc.)</p></li>
</ol>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="02-exercises-scenario-modelling.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Exercises 2: Scenario modelling</p>
      </div>
    </a>
    <a class="right-next"
       href="03-exercises-capacity-expansion.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Exercises 3: Capacity expansion modelling</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-preparation">Data preparation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1-load-data-processing">Step 1: Load data processing</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2-combining-timeseries-data">Step 2: Combining timeseries data</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#network-creation-and-optimization">Network creation and optimization</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#baseline-scenario-analysis">Baseline scenario analysis</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-the-energy-system-configuration">Plot the energy system configuration</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#baseline-with-renewable-generation-limits">Baseline with renewable generation limits</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Plot the energy system configuration</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#impact-of-generation-capacity-limits">Impact of generation capacity limits</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#baseline-with-renewable-generation-limits-and-flow-battery-scenario">Baseline with renewable generation limits and flow battery scenario</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Plot the energy system configuration</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#impact-of-adding-long-duration-energy-storage">Impact of adding long-duration energy storage</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sensitivity-analysis">Sensitivity analysis</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#define-scenarios-and-run-the-optimisation-problems">Define scenarios and run the optimisation problems</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#results-visualisation">Results visualisation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sensitivity-analysis-results">Sensitivity analysis results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#detailed-analysis-of-system-dynamics">Detailed analysis of system dynamics</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion">Conclusion</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#next-steps">Next steps</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Seth van Wieringen
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549"></script>
<script defer src="_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>